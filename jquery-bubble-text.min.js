var bubbleText=function(e){var t,n,a;if(!e|"object"!=typeof e|e.map==[].map)throw"bubbleText() expects an object as argument";if(!(n=(t=$(e.element))[0])||t.find(":first").length)throw'bubbleText() expects one DOM leaf in the property "element".';if("string"!=typeof e.newText)throw'bubbleText() expects one string in the property "newText".';var i=t.css("height"),r=$("<span data-bubbletext>w w</span>").prependTo(t),b=r.width();r.html("w"),b-=2*r.width(),r.remove();var d=[];n.innerHTML=n.innerHTML.replace(/./g,function(e,t){d.push({"char":e,index:t});var n=" "==e?' style="width:'+b+'px"':"";return'<span data-bubbletext="old'+t+'"'+n+">"+e+"</span>"});var l=[];n.innerHTML=e.newText.replace(/./g,function(e,t){for(var n=-1,t=0,a=d.length;a>t;t++)if(d[t]["char"]==e){n=d[t].index,d.splice(t,1);break}return l.push({"char":e,index:t,old:n}),'<span data-bubbletext="new">'+e+"</span>"})+n.innerHTML;for(var o=t.find("span").each(function(){$(this).css({position:"relative",display:"inline-block",height:i,overflow:"hidden"}),"new"==$(this).data("bubbletext")&&($(this).attr("data-bubbletext",$(this).width()||b),$(this).width(0))}),h=0,s=d.length;s>h;h++)t.find("[data-bubbletext=old"+d[h].index+"]:first").attr("data-bubbletext-action","remove");var f=(e.speed||2e3)/(d.length+l.length),c=1,p=0,u=0,x=t.find("[data-bubbletext-action=remove]"),v=0;(a=function(i){if(p&&u)return n.innerHTML=e.newText,void(e.callback instanceof Function&&e.callback());var r=function(){add=c+u,2==u&&(u=1,add-=2),a(i+add)};if(c){if(p||(c=0),v==x.length)return u=2,void r();var b=$(x[v++]);b.animate({width:0},f,r)}else{u||(c=1);var d=o.eq(i),h=+d.attr("data-bubbletext");if(h){var s=l[i];if(~s.old){var b=t.find("[data-bubbletext=old"+s.old+"]:first");b.animate({width:0},f)}d.animate({width:h},f,r)}else p=1,r()}})(0)};
